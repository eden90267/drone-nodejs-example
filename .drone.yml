workspace:
  base: /node
  path: drone/node-example

clone:
  git:
    image: plugins/git
    depath: 50
    tags: true

pipeline:
  frontend:
    image: node:8.3.0
    secrets:
      - source: api_token
      - target: api_token_1
    commands:
      - yarn install
      - ./node_modules/.bin/mocha
      - node env.js
  backend:
    image: node:8.3.0
    secrets:
      - source: api_token_1
      - target: api_token_2
    commands:
      - yarn install
      - ./node_modules/.bin/mocha
      - node env.js